name: Run Stocktake Demo

# Trigger on push, OR allow manual button click
on:
  push:
    branches: [ "main" ]
  workflow_dispatch:

jobs:
  run-pipeline:
    runs-on: ubuntu-latest

    steps:
    # 1. Get the code
    - uses: actions/checkout@v3

    # 2. Set up Python
    - name: Set up Python 3.9
      uses: actions/setup-python@v4
      with:
        python-version: "3.9"

    # 3. Install Libraries (Pandas, etc.)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

    # 4. Generate Mock Data (Crucial Step!)
    # Since we git-ignored real Excel files, we must generate a fake one first.
    - name: Generate Mock SAP Report
      run: python src/mock_data_gen.py

    # 5. Run the Main Pipeline
    - name: Run Stocktake Reporter
      run: python main.py

    # 6. Save the Excel File (The "Artifact")
    # This allows you to download the report from the GitHub Actions page.
    - name: Upload Variance Report
      uses: actions/upload-artifact@v4
      with:
        name: Demo-Variance-Report
        path: output/*.xlsx
        retention-days: 5
